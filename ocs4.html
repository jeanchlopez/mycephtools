<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.2">
<title>Lab: Deploying and Managing OpenShift Container Storage</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Lab: Deploying and Managing OpenShift Container Storage</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_lab_overview">1. Lab Overview</a>
<ul class="sectlevel2">
<li><a href="#_in_this_lab_you_will_learn_how_to">1.1. In this lab you will learn how to</a></li>
</ul>
</li>
<li><a href="#labexercises">2. Deploy your storage backend using the OCS operator</a>
<ul class="sectlevel2">
<li><a href="#_scale_ocp_cluster_and_add_3_new_nodes">2.1. Scale OCP cluster and add 3 new nodes</a></li>
<li><a href="#_installing_the_ocs_operator">2.2. Installing the OCS operator</a></li>
<li><a href="#_getting_to_know_the_storage_dashboards">2.3. Getting to know the Storage Dashboards</a></li>
<li><a href="#_using_the_rook_ceph_toolbox_to_check_on_the_ceph_backing_storage">2.4. Using the Rook-Ceph toolbox to check on the Ceph backing storage</a></li>
</ul>
</li>
<li><a href="#_create_a_new_ocp_application_deployment_using_ceph_rbd_volume">3. Create a new OCP application deployment using Ceph RBD volume</a>
<ul class="sectlevel2">
<li><a href="#_matching_pvs_to_rbds">3.1. Matching PVs to RBDs</a></li>
</ul>
</li>
<li><a href="#_create_a_new_ocp_application_deployment_using_cephfs_volume">4. Create a new OCP application deployment using CephFS volume</a></li>
<li><a href="#_using_the_multi_cloud_gateway">5. Using the Multi-Cloud-Gateway</a>
<ul class="sectlevel2">
<li><a href="#_checking_on_the_mcg_status">5.1. Checking on the MCG status</a></li>
<li><a href="#_creating_an_object_bucket_claim">5.2. Creating an Object Bucket Claim</a></li>
<li><a href="#_using_an_obc_inside_a_container">5.3. Using an OBC inside a container</a></li>
</ul>
</li>
<li><a href="#_adding_storage_to_the_ceph_cluster">6. Adding storage to the Ceph Cluster</a>
<ul class="sectlevel2">
<li><a href="#_add_storage_worker_nodes">6.1. Add storage worker nodes</a></li>
<li><a href="#_add_storage_capacity">6.2. Add storage capacity</a></li>
<li><a href="#_verify_new_storage">6.3. Verify new storage</a></li>
</ul>
</li>
<li><a href="#_using_must_gather">7. Using must-gather</a></li>
<li><a href="#_configuring_the_local_oc_client">Appendix A: Configuring the local oc client</a></li>
<li><a href="#_install_the_noobaa_cli_client">Appendix B: Install the NooBaa CLI client</a></li>
<li><a href="#_introduction_to_ceph">Appendix C: Introduction to Ceph</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_lab_overview">1. Lab Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This hands-on workshop is for both system administrators and application developers interested in learning how to deploy and manage OpenShift Container Storage (OCS). In this lab you will be using OpenShift Container Platform (OCP) 4.x and the OCS operator to deploy Ceph and the Multi-Cloud-Gateway (MCG) as a persistent storage solution for OCP workloads. This instruction was developed using the RHPDS <code>OpenShift 4.2 Workshop</code>.</p>
</div>
<div class="sect2">
<h3 id="_in_this_lab_you_will_learn_how_to">1.1. In this lab you will learn how to</h3>
<div class="ulist">
<ul>
<li>
<p>Configure and deploy containerized Ceph and NooBaa</p>
</li>
<li>
<p>Validate deployment of containerized Ceph Nautilus and NooBaa</p>
</li>
<li>
<p>Deploy the Rook toolbox to run Ceph and RADOS commands</p>
</li>
<li>
<p>Creating a Read-Write-Once (RWO) PVC that is based on Ceph RBDs</p>
</li>
<li>
<p>Creating a Read-Write-Many (RWX) PVC that is based on CephFS</p>
</li>
<li>
<p>Using the MCG to create a bucket</p>
</li>
<li>
<p>Add more storage to the Ceph cluster</p>
</li>
<li>
<p>Use must-gather to collect support information</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-Pods-Diagram.png" alt="Showing OCS4 pods">
</div>
<div class="title">Figure 1. OpenShift Container Storage components</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="labexercises">2. Deploy your storage backend using the OCS operator</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scale_ocp_cluster_and_add_3_new_nodes">2.1. Scale OCP cluster and add 3 new nodes</h3>
<div class="paragraph">
<p>In this section, you will first validate the OCP environment has 3 master and 2 worker nodes (or 3 worker nodes) before increasing the cluster size by additional 3 worker nodes for OCS resources. The <code>NAME</code> of your OCP nodes will be different than shown below.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get nodes</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME                                         STATUS   ROLES    AGE   VERSION
ip-10-0-134-19.us-east-2.compute.internal    Ready    worker   28m   v1.16.2
ip-10-0-142-214.us-east-2.compute.internal   Ready    master   37m   v1.16.2
ip-10-0-145-180.us-east-2.compute.internal   Ready    worker   28m   v1.16.2
ip-10-0-156-224.us-east-2.compute.internal   Ready    master   37m   v1.16.2
ip-10-0-169-15.us-east-2.compute.internal    Ready    master   37m   v1.16.2</pre>
</div>
</div>
<div class="paragraph">
<p>Now you are going to add 3 more OCP compute nodes to cluster using <strong>machinesets</strong>.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get machinesets -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will show you the existing <strong>machinesets</strong> used to create the 3 worker nodes in the cluster already. There is a <strong>machineset</strong> for each AWS AZ (us-east-1a, us-east-1b, us-east-1c). Your <strong>machinesets</strong> <code>NAME</code> will be different than below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get machineset -n openshift-machine-api
NAME                                      DESIRED   CURRENT   READY   AVAILABLE   AGE
cluster-acf9-k8nzk-worker-us-east-2a      1         1         1       1           39m
cluster-acf9-k8nzk-worker-us-east-2b      1         1         1       1           39m
cluster-acf9-k8nzk-worker-us-east-2c      0         0                             39m</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Make sure you do the next step for finding your CLUSTERID</strong>
</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">CLUSTERID</span><span class="tok-o">=</span><span class="tok-k">$(</span>oc get machineset -n openshift-machine-api -o <span class="tok-nv">jsonpath</span><span class="tok-o">=</span><span class="tok-s1">&#39;{.items[0].metadata.labels.machine\.openshift\.io/cluster-api-cluster}&#39;</span><span class="tok-k">)</span>
<span class="tok-nb">echo</span> <span class="tok-nv">$CLUSTERID</span></code></pre>
</div>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl -s https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4ocs4/cluster-workerocs-us-east-2.yaml <span class="tok-p">|</span> sed -e <span class="tok-s2">&quot;s/CLUSTERID/</span><span class="tok-si">${</span><span class="tok-nv">CLUSTERID</span><span class="tok-si">}</span><span class="tok-s2">/g&quot;</span> <span class="tok-p">|</span> oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check that you have new <strong>machines</strong> created.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get machines -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>They may be in <code>pending</code> for sometime so repeat command above until they are in a <code>running</code> STATE. The <code>NAME</code> of your machines will be different than shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                            PHASE         TYPE         REGION      ZONE         AGE
cluster-acf9-k8nzk-master-0                     Running       m5.xlarge    us-east-2   us-east-2a   47m
cluster-acf9-k8nzk-master-1                     Running       m5.xlarge    us-east-2   us-east-2b   47m
cluster-acf9-k8nzk-master-2                     Running       m5.xlarge    us-east-2   us-east-2c   47m
cluster-acf9-k8nzk-worker-us-east-2a-7kkjn      Running       m5.4xlarge   us-east-2   us-east-2a   41m
cluster-acf9-k8nzk-worker-us-east-2b-ttc68      Running       m5.4xlarge   us-east-2   us-east-2b   41m
cluster-acf9-k8nzk-workerocs-us-east-2a-q55rw   Running       m5.4xlarge   us-east-2   us-east-2a   12m
cluster-acf9-k8nzk-workerocs-us-east-2b-clphj   Running       m5.4xlarge   us-east-2   us-east-2b   12m
cluster-acf9-k8nzk-workerocs-us-east-2c-sfhpg   Running       m5.4xlarge   us-east-2   us-east-2c   12m</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the workerocs <strong>machines</strong> are using are also using the AWS EC2 instance type <code>m4.4xlarge</code>. The <code>m4.4xlarge</code> instance type follows our recommended instance sizing for OCS, 16 cpu and 64 GB mem.</p>
</div>
<div class="paragraph">
<p>Now you want to see if our new <strong>machines</strong> are added to the OCP cluster.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>watch oc get machinesets -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step could take more than 5 minutes. The result of this command needs to look like below before you proceed. All new workerocs <strong>machinesets</strong> should have an integer, in this case <code>1</code>, filled out for all rows and under columns <code>READY</code> and <code>AVAILABLE</code>. The <code>NAME</code> of your <strong>machinesets</strong> will be different than shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                      DESIRED   CURRENT   READY   AVAILABLE   AGE
cluster-acf9-k8nzk-worker-us-east-2a      1         1         1       1           47m
cluster-acf9-k8nzk-worker-us-east-2b      1         1         1       1           47m
cluster-acf9-k8nzk-worker-us-east-2c      0         0                             47m
cluster-acf9-k8nzk-workerocs-us-east-2a   1         1         1       1           12m
cluster-acf9-k8nzk-workerocs-us-east-2b   1         1         1       1           12m
cluster-acf9-k8nzk-workerocs-us-east-2c   1         1         1       1           12m</pre>
</div>
</div>
<div class="paragraph">
<p>You can exit by pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span></p>
</div>
<div class="paragraph">
<p>Now check to see that you have 3 new OCP worker nodes. The <code>NAME</code> of your OCP nodes will be different than shown below.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get nodes -l node-role.kubernetes.io/worker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME                                         STATUS   ROLES    AGE    VERSION
ip-10-0-134-19.us-east-2.compute.internal    Ready    worker   45m    v1.16.2
ip-10-0-143-146.us-east-2.compute.internal   Ready    worker   5m6s   v1.16.2
ip-10-0-145-180.us-east-2.compute.internal   Ready    worker   45m    v1.16.2
ip-10-0-153-135.us-east-2.compute.internal   Ready    worker   5m4s   v1.16.2
ip-10-0-165-175.us-east-2.compute.internal   Ready    worker   5m7s   v1.16.2</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_ocs_operator">2.2. Installing the OCS operator</h3>
<div class="paragraph">
<p>Create the openshift-storage namespace.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc create namespace openshift-storage</code></pre>
</div>
</div>
<div class="paragraph">
<p>Label the namespace to enable monitoring.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc label namespace openshift-storage <span class="tok-s2">&quot;openshift.io/cluster-monitoring=true&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then go to the OpenShift console and log in. On the main landing page, follow the instructions below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-OCP-OperatorHub-Filter.png" alt="Locate the OCS Operator">
</div>
<div class="title">Figure 2. Locate OpenShift Container Storage</div>
</div>
<div class="paragraph">
<p>Then install the OpenShift Container Storage Operator by clicking the <code>Install</code> button as illustrated below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-OCP-OperatorHub-Install.png" alt="Install the OCS Operator">
</div>
<div class="title">Figure 3. Install OpenShift Container Storage</div>
</div>
<div class="paragraph">
<p>Make sure to select the <code>openshift-storage</code> namespace by following the instructions below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-OCP-OperatorHub-Subscribe-New.png" alt="Configure the OCS Operator install">
</div>
<div class="title">Figure 4. Install OpenShift Container Storage</div>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>watch oc -n openshift-storage get csv</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME                            DISPLAY                       VERSION   REPLACES   PHASE
lib-bucket-provisioner.v1.0.0   lib-bucket-provisioner        1.0.0                Succeeded
ocs-operator.v4.2.3             OpenShift Container Storage   4.2.3                Succeeded</pre>
</div>
</div>
<div class="paragraph">
<p>You can exit by pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span></p>
</div>
<div class="paragraph">
<p>The resource <code>csv</code> is a shortened word for <code>clusterserviceversions.operators.coreos.com</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Please wait until the operator <code>PHASE</code> changes to <code>Succeeded</code></div>
This will mark that the installation of your operators was successful. Reaching this state can take several minutes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You will now also see some new operator pods in the new <code>openshift-storage</code> namespace:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc -n openshift-storage get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME                                      READY   STATUS    RESTARTS   AGE
lib-bucket-provisioner-5f88699865-w8sps   1/1     Running   0          3m32s
noobaa-operator-59d69f5865-wxlxw          1/1     Running   0          3m6s
ocs-operator-68777b46c5-fljjd             1/1     Running   0          3m6s
rook-ceph-operator-6c5f8fc4dc-rmgbd       1/1     Running   0          3m6s</pre>
</div>
</div>
<div class="paragraph">
<p>Now switch back to your <strong>Openshift Web Console</strong> for the remainder of the installation for OCS 4.</p>
</div>
<div class="paragraph">
<p>Navigate to the <code>Operators</code> menu on the left and select <code>Installed Operators</code>. Make sure the selected project is set to <code>openshift-storage</code>.
What you see, should be similar to the following example picture:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCP-installed-operators.jpg" alt="Openshift showing the installed operators in namespace openshift-storage">
</div>
<div class="title">Figure 5. Installed operators:  1) Make sure you are in the right project; 2) Check Operator status; 3) Click on Openshift Container Storage Operator</div>
</div>
<div class="paragraph">
<p>Click on <code>Openshift Container Storage Operator</code> to get to the OCS configuration screen.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-config-screen-all.png" alt="OCS configuration screen">
</div>
<div class="title">Figure 6. OCS configuration screen</div>
</div>
<div class="paragraph">
<p>On the top of the OCS configuration screen, scroll over to <code>Storage cluster</code> and click on <code>Create OCS Cluster Service</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-config-screen-storage-cluster.png" alt="OCS Create Storage Cluster">
</div>
<div class="title">Figure 7. OCS Create Storage Cluster</div>
</div>
<div class="paragraph">
<p>A dialog box will come up next.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-config-screen-new.png" alt="OCS create a new storage cluster">
</div>
<div class="title">Figure 8. OCS create a new storage cluster</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<strong>Make sure to select three workers in different availability zones using instructions below</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To select the appropriate worker nodes of your OCP 4 cluster you can find them by searching for the node label <code>role=storage-node</code>.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get nodes --show-labels <span class="tok-p">|</span> grep storage-node <span class="tok-p">|</span>cut -d<span class="tok-s1">&#39; &#39;</span> -f1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select the three nodes that resulted from the command above. Then click on the button <code>Create</code> below the dialog box where you selected the 3 workers with a <code>checkmark</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It would be a good practice to add a unique label to OCP nodes that are to be used for creating the <code>Storage Cluster</code> prior to this step so they are easy to find in list of OCP nodes. In this case it was done by adding this label, <code>role=storage-node</code>, in the machineset YAML files that you used earlier to create the new OCS worker nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the background this will start initiating a lot of new pods in the <code>openshift-storage</code> namespace, as can be seen on the CLI:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc -n openshift-storage get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example of a in process installation of the OCS storage cluster:</div>
<div class="content">
<pre>NAME                                            READY   STATUS        RESTARTS   AGE
csi-cephfsplugin-2fsv2                          3/3     Running       0          76s
csi-cephfsplugin-8tfb8                          3/3     Running       0          76s
csi-cephfsplugin-dzgjq                          3/3     Running       0          76s
csi-cephfsplugin-provisioner-5b49687dff-9sx9q   4/4     Running       0          76s
csi-cephfsplugin-provisioner-5b49687dff-gvq4h   4/4     Running       0          76s
csi-cephfsplugin-qfw49                          3/3     Running       0          76s
csi-cephfsplugin-zgmbs                          3/3     Running       0          76s
csi-rbdplugin-4b4pj                             3/3     Running       0          76s
csi-rbdplugin-4sml6                             3/3     Running       0          76s
csi-rbdplugin-9vmf5                             3/3     Running       0          76s
csi-rbdplugin-bm264                             3/3     Running       0          76s
csi-rbdplugin-provisioner-745584dcf8-6kqn7      4/4     Running       0          76s
csi-rbdplugin-provisioner-745584dcf8-khkz8      4/4     Running       0          76s
csi-rbdplugin-zfthr                             3/3     Running       0          76s
lib-bucket-provisioner-5f88699865-w8sps         1/1     Running       0          7m4s
noobaa-operator-59d69f5865-wxlxw                1/1     Running       0          6m38s
ocs-operator-68777b46c5-fljjd                   0/1     Running       0          6m38s
rook-ceph-mon-a-canary-765d868b84-m7vfx         1/1     Terminating   0          54s
rook-ceph-mon-b-canary-78c846b64f-p2t8g         1/1     Running       0          43s
rook-ceph-mon-c-canary-d668bdcd-48hwp           1/1     Running       0          33s
rook-ceph-operator-6c5f8fc4dc-rmgbd             1/1     Running       0          6m38s</pre>
</div>
</div>
<div class="paragraph">
<p>You can also watch the deployment using the <strong>Openshift Web Console</strong> by going back to the <code>Openshift Container Storage Operator</code> screen and selecting <code>All instances</code>.</p>
</div>
<div class="paragraph">
<p>Please wait until all <strong>Pods</strong> are marked as <code>Running</code> in the CLI or until you see all instances shown below as <code>Ready</code> Status in the Web Console. Some instances may stay in <code>Unknown</code> Status which is not a concern if your <code>Ready</code> status matches the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-finished-cluster-install.png" alt="OCS instance overview after cluster install is finished">
</div>
<div class="title">Figure 9. OCS instance overview after cluster install is finished</div>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc -n openshift-storage get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output when the cluster installation is finished</div>
<div class="content">
<pre>NAME                                                              READY   STATUS      RESTARTS   AGE
csi-cephfsplugin-2fsv2                                            3/3     Running     0          9m48s
csi-cephfsplugin-8tfb8                                            3/3     Running     0          9m48s
csi-cephfsplugin-dzgjq                                            3/3     Running     0          9m48s
csi-cephfsplugin-provisioner-5b49687dff-9sx9q                     4/4     Running     0          9m48s
csi-cephfsplugin-provisioner-5b49687dff-gvq4h                     4/4     Running     0          9m48s
csi-cephfsplugin-qfw49                                            3/3     Running     0          9m48s
csi-cephfsplugin-zgmbs                                            3/3     Running     0          9m48s
csi-rbdplugin-4b4pj                                               3/3     Running     0          9m48s
csi-rbdplugin-4sml6                                               3/3     Running     0          9m48s
csi-rbdplugin-9vmf5                                               3/3     Running     0          9m48s
csi-rbdplugin-bm264                                               3/3     Running     0          9m48s
csi-rbdplugin-provisioner-745584dcf8-6kqn7                        4/4     Running     0          9m48s
csi-rbdplugin-provisioner-745584dcf8-khkz8                        4/4     Running     0          9m48s
csi-rbdplugin-zfthr                                               3/3     Running     0          9m48s
lib-bucket-provisioner-5f88699865-w8sps                           1/1     Running     0          15m
noobaa-core-0                                                     2/2     Running     0          4m50s
noobaa-operator-59d69f5865-wxlxw                                  1/1     Running     0          15m
ocs-operator-68777b46c5-fljjd                                     1/1     Running     0          15m
rook-ceph-drain-canary-13eb68abef6538b2977c634868f221d6-65hldft   1/1     Running     0          4m56s
rook-ceph-drain-canary-3b6426357790a7c439eb04a154085a2c-66ckpht   1/1     Running     0          5m12s
rook-ceph-drain-canary-d3f350fd650099d390c9bc3e6a8e5492-5926rbv   1/1     Running     0          5m3s
rook-ceph-mds-ocs-storagecluster-cephfilesystem-a-5b96bd8ds2v9v   1/1     Running     0          4m45s
rook-ceph-mds-ocs-storagecluster-cephfilesystem-b-6c7cd576nq54b   1/1     Running     0          4m45s
rook-ceph-mgr-a-7b84495bd6-sg42t                                  1/1     Running     0          6m1s
rook-ceph-mon-a-6d5cdc889b-db4w9                                  1/1     Running     0          7m35s
rook-ceph-mon-b-6bb75f4879-td2jh                                  1/1     Running     0          7m11s
rook-ceph-mon-c-56fdb8f844-296tt                                  1/1     Running     0          6m38s
rook-ceph-operator-6c5f8fc4dc-rmgbd                               1/1     Running     0          15m
rook-ceph-osd-0-857b9cd4b-46zdb                                   1/1     Running     0          5m12s
rook-ceph-osd-1-fb45c66dc-pqqmx                                   1/1     Running     0          5m3s
rook-ceph-osd-2-6b96c984c4-4dgs2                                  1/1     Running     0          4m56s
rook-ceph-osd-prepare-ocs-deviceset-0-0-x8hf8-vvjwq               0/1     Completed   0          5m40s
rook-ceph-osd-prepare-ocs-deviceset-1-0-ctf89-tmmmx               0/1     Completed   0          5m40s
rook-ceph-osd-prepare-ocs-deviceset-2-0-7fktc-zvspp               0/1     Completed   0          5m39s</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getting_to_know_the_storage_dashboards">2.3. Getting to know the Storage Dashboards</h3>
<div class="paragraph">
<p>You can now also check the status of your storage cluster with the OCS specific <strong>Dashboards</strong> that are included in your <strong>Openshift Web Console</strong>. You can reach this by clicking on <code>Home</code> on your left navigation bar, then selecting <code>Dashboards</code> and finally clicking on <code>Persistent Storage</code> on the top navigation bar of the content page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-dashboard-healthy-new.png" alt="OCS Dashboard after successful backing storage installation">
</div>
<div class="title">Figure 10. OCS Dashboard after successful backing storage installation</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 0%;">
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;1&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Health</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Quick overview of the general health of the storage cluster</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;2&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Details</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Overview of the deployed storage cluster version and backend provider</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;3&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inventory</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>List of all the resources that are used and offered by the storage system</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;4&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Events</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Live overview of all the changes that are being done affecting the storage cluster</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;5&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utilization</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Overview of the storage cluster usage</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>OCS ships with a <strong>Dashboard</strong> for the Object Store service as well. From within the <strong>Dashboard</strong> menu click on the <code>Object Service</code> on the top navigation bar of the content page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-noobaa-dashboard-healthy-new.png" alt="OCS Multi-Cloud-Gateway Dashboard after successful installation">
</div>
<div class="title">Figure 11. OCS Multi-Cloud-Gateway Dashboard after successful installation</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 0%;">
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;1&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Health</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Quick overview of the general health of the Multi-Cloud-Gateway</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;2&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Details</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Overview of the deployed MCG version and backend provider including a link to the MCG Dashboard</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;3&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buckets</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>List of all the ObjectBucket with are offered and ObjectBucketClaims which are connected to them</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;4&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource Providers</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Shows the list of configured Resource Providers that are available as backing storage in the MCG</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once this is all healthy, you will be able to use the three new <code>StorageClasses</code> created during the OCS 4 Install:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ocs-storagecluster-ceph-rbd</p>
</li>
<li>
<p>ocs-storagecluster-cephfs</p>
</li>
<li>
<p>openshift-storage.noobaa.io</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see these three <code>StorageClasses</code> from the Openshift Web Console by expanding the <code>Storage</code> menu in the left navigation bar and selecting <code>Storage Classes</code>. You can also run the command below:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc -n openshift-storage get sc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please make sure the three storage classes are available in your cluster before proceeding.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NooBaa pod used the <code>ocs-storagecluster-ceph-rbd</code> storage class for creating a PVC for mounting to it&#8217;s <code>db</code> container.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_rook_ceph_toolbox_to_check_on_the_ceph_backing_storage">2.4. Using the Rook-Ceph toolbox to check on the Ceph backing storage</h3>
<div class="paragraph">
<p>Since the Rook-Ceph <strong>toolbox</strong> is not shipped with OCS, we need to deploy it manually. For this, we can leverage the upstream <code>toolbox.yaml</code> file, but we need to modify the namespace as shown below.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl -s https://raw.githubusercontent.com/rook/rook/release-1.1/cluster/examples/kubernetes/ceph/toolbox.yaml <span class="tok-p">|</span> sed <span class="tok-s1">&#39;s/namespace: rook-ceph/namespace: openshift-storage/g&#39;</span><span class="tok-p">|</span> oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the <code>rook-ceph-tools</code> <strong>Pod</strong> is <code>Running</code> you can access the toolbox like this:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">TOOLS_POD</span><span class="tok-o">=</span><span class="tok-k">$(</span>oc get pods -n openshift-storage -l <span class="tok-nv">app</span><span class="tok-o">=</span>rook-ceph-tools -o name<span class="tok-k">)</span>
oc rsh -n openshift-storage <span class="tok-nv">$TOOLS_POD</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once inside the toolbox, try out the following Ceph commands:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>ceph status
ceph osd status
ceph osd tree
ceph df
rados df
ceph versions</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>sh-4.2# ceph status
cluster:
  id:     7d0f7306-84fa-4e32-a04d-f7a588501487
  health: HEALTH_OK

services:
  mon: <span class="tok-m">3</span> daemons, quorum a,b,c <span class="tok-o">(</span>age 7m<span class="tok-o">)</span>
  mgr: a<span class="tok-o">(</span>active, since 6m<span class="tok-o">)</span>
  mds: ocs-storagecluster-cephfilesystem:1 <span class="tok-o">{</span><span class="tok-nv">0</span><span class="tok-o">=</span>ocs-storagecluster-cephfilesystem-a<span class="tok-o">=</span>up:active<span class="tok-o">}</span> <span class="tok-m">1</span> up:standby-replay
  osd: <span class="tok-m">3</span> osds: <span class="tok-m">3</span> up <span class="tok-o">(</span>since 5m<span class="tok-o">)</span>, <span class="tok-m">3</span> in <span class="tok-o">(</span>since 5m<span class="tok-o">)</span>

data:
  pools:   <span class="tok-m">3</span> pools, <span class="tok-m">24</span> pgs
  objects: <span class="tok-m">90</span> objects, <span class="tok-m">74</span> MiB
  usage:   <span class="tok-m">3</span>.1 GiB used, <span class="tok-m">6</span>.0 TiB / <span class="tok-m">6</span>.0 TiB avail
  pgs:     <span class="tok-m">24</span> active+clean

io:
  client:   <span class="tok-m">853</span> B/s rd, <span class="tok-m">35</span> KiB/s wr, <span class="tok-m">1</span> op/s rd, <span class="tok-m">3</span> op/s wr</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can exit the toolbox by either pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>D</kbd></span> or by executing <code>exit</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_new_ocp_application_deployment_using_ceph_rbd_volume">3. Create a new OCP application deployment using Ceph RBD volume</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section the <code>ocs-storagecluster-ceph-rbd</code> <strong>storage class</strong> will be used by an OCP application + database <strong>deployment</strong> to create RWO (ReadWriteOnce) persistent storage. The persistent storage will be a Ceph RBD (RADOS Block Device) volume (object) in the Ceph pool <code>ocs-storagecluster-cephblockpool</code>.</p>
</div>
<div class="paragraph">
<p>To do so we have created a template file, based on the OpenShift rails-pgsql-persistent template, that includes an extra parameter STORAGE_CLASS that enables the end user to specify the storage class the PVC should use.
Feel free to download <code><a href="https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4ocs4/configurable-rails-app.yaml" class="bare">https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4ocs4/configurable-rails-app.yaml</a></code> to check on the format of this template. Search for <code>STORAGE_CLASS</code> in the downloaded content.</p>
</div>
<div class="paragraph">
<p>Make sure that you completed all previous sections so that you are ready to start the Rails + PostgreSQL deployment.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc new-project my-database-app
curl https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4ocs4/configurable-rails-app.yaml <span class="tok-p">|</span> oc new-app -p <span class="tok-nv">STORAGE_CLASS</span><span class="tok-o">=</span>ocs-storagecluster-ceph-rbd -p <span class="tok-nv">VOLUME_CAPACITY</span><span class="tok-o">=</span>5Gi -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the deployment is started you can monitor with these commands.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc status
oc get pvc -n my-database-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step could take 5 or more minutes. Wait until there are 2 <strong>Pods</strong> in <code>Running</code> STATUS and 4 <strong>Pods</strong> in <code>Completed</code> STATUS as shown below.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>watch oc get pods -n my-database-app</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME                                READY   STATUS      RESTARTS   AGE
postgresql-1-8vr2c                  1/1     Running     1          5m40s
postgresql-1-deploy                 0/1     Completed   0          5m48s
rails-pgsql-persistent-1-build      0/1     Completed   0          5m49s
rails-pgsql-persistent-1-deploy     0/1     Completed   0          5m49s
rails-pgsql-persistent-1-hook-pre   0/1     Completed   0          3m28s
rails-pgsql-persistent-1-mcmjf      1/1     Running     1          3m14s</pre>
</div>
</div>
<div class="paragraph">
<p>You can exit by pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span></p>
</div>
<div class="paragraph">
<p>Once the deployment is complete you can now test the application and the persistent storage on Ceph. Your <code>HOST/PORT</code> will be different.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get route -n my-database-app</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME                     HOST/PORT                                                                         PATH   SERVICES                 PORT    TERMINATION   WILDCARD
rails-pgsql-persistent   rails-pgsql-persistent-my-database-app.apps.cluster-acf9.acf9.sandbox1647.opentlc.com          rails-pgsql-persistent</pre>
</div>
</div>
<div class="paragraph">
<p>Copy your <code>rails-pgsql-persistent</code> route (different than above) to a browser window to create articles. You will need to append <code>/articles</code> to the end.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong>  <a href="http://&lt;your_route&gt;/articles" class="bare">http://&lt;your_route&gt;/articles</a></p>
</div>
<div class="paragraph">
<p>Enter the <code>username</code> and <code>password</code> below to create articles and comments. The articles and comments are saved in a PostgreSQL database which stores its table spaces on the Ceph RBD volume provisioned using the <code>ocs-storagecluster-ceph-rbd</code> <strong>storageclass</strong> during the application deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="tok-na">username: openshift</span>
<span class="tok-na">password: secret</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets now take another look at the Ceph <code>ocs-storagecluster-cephblockpool</code> created by the <code>ocs-storagecluster-ceph-rbd</code> <strong>Storage Class</strong>. Log into the <strong>toolbox</strong> pod again.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">TOOLS_POD</span><span class="tok-o">=</span><span class="tok-k">$(</span>oc get pods -n openshift-storage -l <span class="tok-nv">app</span><span class="tok-o">=</span>rook-ceph-tools -o name<span class="tok-k">)</span>
oc rsh -n openshift-storage <span class="tok-nv">$TOOLS_POD</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the same Ceph commands as before the application deployment and compare to results in prior section. Notice the number of objects in <code>ocs-storagecluster-cephblockpool</code> has increased. The third command lists RBDs and we should now have two RBDs.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>ceph df
rados df
rbd -p ocs-storagecluster-cephblockpool ls <span class="tok-p">|</span> grep vol</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can exit the toolbox by either pressing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>D</kbd></span> or by executing <code>exit</code>.</p>
</div>
<div class="sect2">
<h3 id="_matching_pvs_to_rbds">3.1. Matching PVs to RBDs</h3>
<div class="paragraph">
<p>A handy way to match persistent volumes to Ceph RBDs is to execute:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get pv -o <span class="tok-s1">&#39;custom-columns=NAME:.spec.claimRef.name,PVNAME:.metadata.name,STORAGECLASS:.spec.storageClassName,VOLUMEHANDLE:.spec.csi.volumeHandle&#39;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME                      PVNAME                                     STORAGECLASS                  VOLUMEHANDLE
ocs-deviceset-0-0-z2xzg   pvc-1b636a3f-f978-11e9-9bdd-005056818b15   thin                          &lt;none&gt;
ocs-deviceset-1-0-wcrql   pvc-1b64c8e5-f978-11e9-9bdd-005056818b15   thin                          &lt;none&gt;
ocs-deviceset-2-0-b82nr   pvc-1b6618fa-f978-11e9-9bdd-005056818b15   thin                          &lt;none&gt;
postgresql                pvc-3967abba-fbcd-11e9-9bdd-005056818b15   ocs-storagecluster-ceph-rbd   0001-0011-openshift-storage-0000000000000001-39787034-fbcd-11e9-8be1-0a580a810213
my-shared-storage         pvc-ab06ddc4-fbc0-11e9-9d0a-00505681bc30   ocs-storagecluster-cephfs     0001-0011-openshift-storage-0000000000000001-ab869bbf-fbc0-11e9-92f8-0a580a800411
db-noobaa-core-0          pvc-b8490616-f977-11e9-9bdd-005056818b15   ocs-storagecluster-ceph-rbd   0001-0011-openshift-storage-0000000000000001-5c29f1e6-f978-11e9-8be1-0a580a810213
rook-ceph-mon-a           pvc-c434ab90-f977-11e9-9bdd-005056818b15   thin                          &lt;none&gt;
rook-ceph-mon-b           pvc-c74f9f10-f977-11e9-9bdd-005056818b15   thin                          &lt;none&gt;
rook-ceph-mon-c           pvc-ca4eea2e-f977-11e9-9bdd-005056818b15   thin                          &lt;none&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The second half of the <code>VOLUMEHANDLE</code> column mostly matches what your RBD is named inside of Ceph. All you have to do is append <code>csi-vol-</code> to the front like this:</p>
</div>
<div class="listingblock execute">
<div class="title">Get the full RBD name of our postgreSQL PV in one command</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get pv pvc-3967abba-fbcd-11e9-9bdd-005056818b15 -o <span class="tok-nv">jsonpath</span><span class="tok-o">=</span><span class="tok-s1">&#39;{.spec.csi.volumeHandle}&#39;</span> <span class="tok-p">|</span> cut -d <span class="tok-s1">&#39;-&#39;</span> -f <span class="tok-m">6</span>- <span class="tok-p">|</span> awk <span class="tok-s1">&#39;{print &quot;csi-vol-&quot;$1}&#39;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>csi-vol-39787034-fbcd-11e9-8be1-0a580a810213</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important to use the <code>PVNAME</code> in the above command</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we can check on the details of our RBD from inside of the tools pod:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">TOOLS_POD</span><span class="tok-o">=</span><span class="tok-k">$(</span>oc get pods -n openshift-storage -l <span class="tok-nv">app</span><span class="tok-o">=</span>rook-ceph-tools -o name<span class="tok-k">)</span>

oc rsh -n openshift-storage <span class="tok-nv">$TOOLS_POD</span> rbd -p ocs-storagecluster-cephblockpool info csi-vol-39787034-fbcd-11e9-8be1-0a580a810213</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>rbd image 'csi-vol-39787034-fbcd-11e9-8be1-0a580a810213':
        size 5 GiB in 1280 objects
        order 22 (4 MiB objects)
        snapshot_count: 0
        id: 75a68ab19dfcb
        block_name_prefix: rbd_data.75a68ab19dfcb
        format: 2
        features: layering
        op_features:
        flags:
        create_timestamp: Thu Oct 31 10:57:27 2019
        access_timestamp: Thu Oct 31 10:57:27 2019
        modify_timestamp: Thu Oct 31 10:57:27 2019</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will need to adjust the command to fit to your RBD name</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_new_ocp_application_deployment_using_cephfs_volume">4. Create a new OCP application deployment using CephFS volume</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section the <code>ocs-storagecluster-cephfs</code> <strong>Storage Class</strong> will be used to create a RWX (ReadWriteMany) PVC that can be used by multiple pods at the same time. The application we will use is called <code>File Uploader</code>.</p>
</div>
<div class="paragraph">
<p>Create a new project:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc new-project my-shared-storage</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next deploy the example PHP application called <code>file-uploader</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc new-app openshift/php:7.1~https://github.com/christianh814/openshift-php-upload-demo --name<span class="tok-o">=</span>file-uploader</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre>--&gt; Found image 691930e (5 weeks old) in image stream "openshift/php" under tag "7.1" for "openshift/php:7.1"

    Apache 2.4 with PHP 7.1
    -----------------------
    PHP 7.1 available as container is a base platform for building and running various PHP 7.1 applications and frameworks. PHP is an HTML-embedded scripting language. PHP attempts to make it easy for developers to write dynamically generated web pages. PHP also offers built-in database integration for several commercial and non-commercial database management systems, so writing a database-enabled webpage with PHP is fairly simple. The most common use of PHP coding is probably as a replacement for CGI scripts.

    Tags: builder, php, php71, rh-php71

    * A source build using source code from https://github.com/christianh814/openshift-php-upload-demo will be created
      * The resulting image will be pushed to image stream tag "file-uploader:latest"
      * Use 'start-build' to trigger a new build
    * This image will be deployed in deployment config "file-uploader"
    * Ports 8080/tcp, 8443/tcp will be load balanced by service "file-uploader"
      * Other containers can access this service through the hostname "file-uploader"

--&gt; Creating resources ...
    imagestream.image.openshift.io "file-uploader" created
    buildconfig.build.openshift.io "file-uploader" created
    deploymentconfig.apps.openshift.io "file-uploader" created
    service "file-uploader" created
--&gt; Success
    Build scheduled, use 'oc logs -f bc/file-uploader' to track its progress.
    Application is not exposed. You can expose services to the outside world by executing one or more of the commands below:
     'oc expose svc/file-uploader'
    Run 'oc status' to view your app.</pre>
</div>
</div>
<div class="paragraph">
<p>Watch and wait for the application to be deployed:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc logs -f bc/file-uploader -n my-shared-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre>Cloning "https://github.com/christianh814/openshift-php-upload-demo" ...
	Commit:	7508da63d78b4abc8d03eac480ae930beec5d29d (Update index.html)
	Author:	Christian Hernandez &lt;christianh814@users.noreply.github.com&gt;
	Date:	Thu Mar 23 09:59:38 2017 -0700
---&gt; Installing application source

[...]

Pushing image docker-registry.default.svc:5000/my-shared-storage/file-uploader:latest ...
Pushed 2/6 layers, 34% complete
Pushed 3/6 layers, 55% complete
Pushed 4/6 layers, 82% complete
Pushed 5/6 layers, 97% complete
Pushed 6/6 layers, 100% complete
Push successful</pre>
</div>
</div>
<div class="paragraph">
<p>The command prompt returns out of the tail mode once you see <em>Push successful</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This use of the <code>new-app</code> command directly asked for application code to be
built and did not involve a template. That&#8217;s why it only created a <strong>single
Pod</strong> deployment with a <strong>Service</strong> and no <strong>Route</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s make our application production ready by exposing it via a <code>Route</code> and scale to 3 instances for high availability:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc expose svc/file-uploader -n my-shared-storage
oc scale --replicas<span class="tok-o">=</span><span class="tok-m">3</span> dc/file-uploader -n my-shared-storage
oc get pods -n my-shared-storage</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should have 3 <code>file-uploader</code> <strong>Pods</strong> in a few minutes.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Never attempt to store persistent data in a <strong>Pod</strong> that has no persistent
volume associated with it. <strong>Pods</strong> and their containers are ephemeral by
definition, and any stored data will be lost as soon as the <strong>Pod</strong> terminates
for whatever reason.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The app is of course not useful like this. We can fix this by providing shared
storage to this app.</p>
</div>
<div class="paragraph">
<p>You can create a <strong>PersistentVolumeClaim</strong> and attach it into an application with
the <code>oc set volume</code> command. Execute the following</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc <span class="tok-nb">set</span> volume dc/file-uploader --add --name<span class="tok-o">=</span>my-shared-storage <span class="tok-se">\</span>
-t pvc --claim-mode<span class="tok-o">=</span>ReadWriteMany --claim-size<span class="tok-o">=</span>1Gi <span class="tok-se">\</span>
--claim-name<span class="tok-o">=</span>my-shared-storage --claim-class<span class="tok-o">=</span>ocs-storagecluster-cephfs <span class="tok-se">\</span>
--mount-path<span class="tok-o">=</span>/opt/app-root/src/uploaded <span class="tok-se">\</span>
-n my-shared-storage</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a <strong>PersistentVolumeClaim</strong></p>
</li>
<li>
<p>update the <strong>DeploymentConfig</strong> to include a <code>volume</code> definition</p>
</li>
<li>
<p>update the <strong>DeploymentConfig</strong> to attach a <code>volumemount</code> into the specified
<code>mount-path</code></p>
</li>
<li>
<p>cause a new deployment of the 3 application <strong>Pods</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on what <code>oc set volume</code> is capable of, look at its help output
with <code>oc set volume -h</code>. Now, let&#8217;s look at the result of adding the volume:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get pvc -n my-shared-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre>NAME                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS                AGE
my-shared-storage   Bound    pvc-371c2184-fb73-11e9-b901-0aad1a53052d   1Gi        RWX            ocs-storagecluster-cephfs   47s</pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>ACCESSMODE</code> being set to <strong>RWX</strong> (short for <code>ReadWriteMany</code>).</p>
</div>
<div class="paragraph">
<p>All 3 <code>file-uploader</code><strong>Pods</strong> are using the sane <strong>RWX</strong> volume. Without this <code>ACCESSMODE</code>, OpenShift will not attempt to attach multiple <strong>Pods</strong> to the same <strong>PersistentVolume</strong>
reliably. If you attempt to scale up deployments that are using <strong>RWO</strong> or <code>ReadWriteOnce</code> storage, the <strong>Pods</strong> will actually all become co-located on the same
node.</p>
</div>
<div class="paragraph">
<p>Try it out in your file uploader web application using your browser. Upload
new files.</p>
</div>
<div class="paragraph">
<p>Now, check the <strong>Route</strong> that has been created:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get route file-uploader -n my-shared-storage -o jsonpath --template<span class="tok-o">=</span><span class="tok-s2">&quot;{.spec.host}&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return a route similar to this one (careful: there is no line break at the end so your shell prompt appears right after the output).</p>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre>file-uploader-my-shared-storage.apps.cluster-ocs-9b06.ocs-9b06.example.opentlc.com</pre>
</div>
</div>
<div class="paragraph">
<p>Point your browser to the web application using the URL advertised by your route. <strong>Your <code>route</code> will be different</strong></p>
</div>
<div class="paragraph">
<p>The web app simply lists all uploaded files and offers the ability to upload new ones as well as download the existing data. Right now there is
nothing.</p>
</div>
<div class="paragraph">
<p>Select an arbitrary file from your local machine and upload it to the app.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/uploader_screen_upload.png" alt="uploader screen upload">
</div>
<div class="title">Figure 12. A simple PHP-based file upload tool</div>
</div>
<div class="paragraph">
<p>Once done click <strong><em>List uploaded files</em></strong> to see the list of all currently
uploaded files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_multi_cloud_gateway">5. Using the Multi-Cloud-Gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section discusses the usage of the Multi-Cloud-Gateway (MCG). It is expected that the installation of MCG has been finished successfully and the local <code>oc</code> client is configured correctly to connect to the Openshift cluster.
Currently the best way to configure the MCG is to use the CLI.</p>
</div>
<div class="paragraph">
<p>To install the CLI follow the <a href="#_install_the_noobaa_cli_client">Install the NooBaa CLI client</a> section. The noobaa client can be installed on your personal laptop or on the VM provided in your OpenTLC environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While the NooBaa Web Management Console is accessible, it should not be used to create any resources, since they are currently not syncronised back to the Openshift cluster.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_checking_on_the_mcg_status">5.1. Checking on the MCG status</h3>
<div class="paragraph">
<p>The MCG status can be checked with the NooBaa CLI. Make sure you are in the <code>openshift-storage</code> project when you execute this command.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>noobaa status -n openshift-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>INFO[0000] CLI version: 2.0.3
INFO[0000] noobaa-image: noobaa/noobaa-core:5
INFO[0000] operator-image: noobaa/noobaa-operator:2.0.3
INFO[0000] Namespace: openshift-storage
INFO[0000]
INFO[0000] CRD Status:
INFO[0001]  Exists: CustomResourceDefinition "noobaas.noobaa.io"
INFO[0001]  Exists: CustomResourceDefinition "backingstores.noobaa.io"
INFO[0001]  Exists: CustomResourceDefinition "bucketclasses.noobaa.io"
INFO[0001]  Exists: CustomResourceDefinition "objectbucketclaims.objectbucket.io"
INFO[0001]  Exists: CustomResourceDefinition "objectbuckets.objectbucket.io"
INFO[0001]
INFO[0001] Operator Status:
INFO[0001]  Exists: Namespace "openshift-storage"
INFO[0001]  Exists: ServiceAccount "noobaa"
INFO[0002]  Not Found: Role "noobaa"
INFO[0002]  Not Found: RoleBinding "noobaa"
INFO[0002]  Not Found: ClusterRole "openshift-storage.noobaa.io"
INFO[0002]  Not Found: ClusterRoleBinding "openshift-storage.noobaa.io"
INFO[0002]  Exists: Deployment "noobaa-operator"
INFO[0002]
INFO[0002] System Status:
INFO[0002]  Exists: NooBaa "noobaa"
INFO[0002]  Exists: StatefulSet "noobaa-core"
INFO[0002]  Exists: Service "noobaa-mgmt"
INFO[0002]  Exists: Service "s3"
INFO[0003]  Exists: Secret "noobaa-server"
INFO[0003]  Exists: Secret "noobaa-operator"
INFO[0003]  Exists: Secret "noobaa-admin"
INFO[0003]  Exists: StorageClass "openshift-storage.noobaa.io"
INFO[0003]  Exists: BucketClass "noobaa-default-bucket-class"
INFO[0003]  (Optional) Exists: BackingStore "noobaa-default-backing-store"
INFO[0003]  (Optional) Exists: CredentialsRequest "noobaa-cloud-creds"
INFO[0003]  (Optional) Exists: PrometheusRule "noobaa-prometheus-rules"
INFO[0003]  (Optional) Exists: ServiceMonitor "noobaa-service-monitor"
INFO[0004]  Exists: PersistentVolumeClaim "db-noobaa-core-0"
INFO[0004]  System Phase is "Ready"
INFO[0004]  Exists: Secret "noobaa-admin"

#------------------#
#- Mgmt Addresses -#
#------------------#

ExternalDNS : [https://a2cda7307f66011e990940a5305de57b-1618762379.us-east-1.elb.amazonaws.com:443]
ExternalIP  : []
NodePorts   : [https://10.0.171.35:32253]
InternalDNS : [https://noobaa-mgmt.openshift-storage:443]
InternalIP  : [https://172.30.50.123:443]
PodPorts    : [https://10.129.2.26:8443]

#--------------------#
#- Mgmt Credentials -#
#--------------------#

system: noobaa
email: admin@noobaa.io
password: O9qBQf8eJZy6cN5yqaughA==

#----------------#
#- S3 Addresses -#
#----------------#

ExternalDNS : [https://a2cdff448f66011e990940a5305de57b-1965616628.us-east-1.elb.amazonaws.com:443]
ExternalIP  : []
NodePorts   : [https://10.0.171.35:31242]
InternalDNS : [https://s3.openshift-storage:443]
InternalIP  : [https://172.30.145.183:443]
PodPorts    : [https://10.129.2.26:6443]

#------------------#
#- S3 Credentials -#
#------------------#

AWS_ACCESS_KEY_ID: &lt;NooBaa_ACCESS_KEY_ID&gt;
AWS_SECRET_ACCESS_KEY:&lt;NooBaa_SECRET_ACCESS_KEY_ID&gt;

#------------------#
#- Backing Stores -#
#------------------#

NAME                           TYPE     TARGET-BUCKET                                               PHASE   AGE
noobaa-default-backing-store   aws-s3   noobaa-backing-store-8a7f9c1b-2616-41fa-bd9e-dbf7334f4768   Ready   2m24s

#------------------#
#- Bucket Classes -#
#------------------#

NAME                          PLACEMENT                                                             PHASE   AGE
noobaa-default-bucket-class   {Tiers:[{Placement: BackingStores:[noobaa-default-backing-store]}]}   Ready   2m24s

#-----------------#
#- Bucket Claims -#
#-----------------#

No OBC's found.</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see - the NooBaa CLI will first check on the environment and will then print all the information about the environment.
Besides the status of the MCG, the second most intersting information for us are the available S3 addresses that we can use to connect to our MCG buckets. We can chose between using the external DNS which incurs DNS traffic cost, or route internally inside of our Openshift cluster.</p>
</div>
<div class="paragraph">
<p>You can get a more basic overview of the MCG status using the Object Storage <strong>Dashboard</strong>. To reach this, log into the <strong>Openshift Web Console</strong>, click on <code>Home</code> and select the <code>Dashboards</code> item. In the main view, select <code>Object Service</code> in the top navigation bar.
This dashboard does not give you connection information for your S3 endpoint, but offers Graphs and runtime information about the usage of your S3 backend.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_an_object_bucket_claim">5.2. Creating an Object Bucket Claim</h3>
<div class="paragraph">
<p>An Object Bucket Claim (OBC) can be used to request a S3 compatible bucket backend for your workloads. When creating an OBC you get a ConfigMap (CM) and a Secret that together contain all the information your application needs to use the object storage service.</p>
</div>
<div class="paragraph">
<p>Creating an OBC is as simple as using the NooBaa CLI:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>noobaa obc create test21obc -n openshift-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>INFO[0001]  Created: ObjectBucketClaim "test21obc"</pre>
</div>
</div>
<div class="paragraph">
<p>The NooBaa CLI has created the necessary configuration inside of NooBaa and has informed Openshift about the new OBC:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get obc -n openshift-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME        STORAGE-CLASS                 PHASE   AGE
test21obc   openshift-storage.noobaa.io   Bound   38s</pre>
</div>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get obc test21obc -o yaml -n openshift-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">objectbucket.io/v1alpha1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ObjectBucketClaim</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">creationTimestamp</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;2019-10-24T13:30:07Z&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">finalizers</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">objectbucket.io/finalizer</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">generation</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">2</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">noobaa</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">bucket-provisioner</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage.noobaa.io-obc</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">noobaa-domain</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage.noobaa.io</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">test21obc</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">resourceVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;40756&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selfLink</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/apis/objectbucket.io/v1alpha1/namespaces/openshift-storage/objectbucketclaims/test21obc</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">uid</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">64f04cba-f662-11e9-bc3c-0295250841af</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">spec</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ObjectBucketName</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">obc-openshift-storage-test21obc</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">bucketName</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">test21obc-933348a6-e267-4f82-82f1-e59bf4fe3bb4</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">generateBucketName</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">test21obc</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">storageClassName</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage.noobaa.io</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">status</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">phase</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Bound</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside of your <code>openshift-storage</code> namespace, you will now find the CM and the secret to use this OBC. The CM and the secret have the same name as the OBC:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get -n openshift-storage secret test21obc -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">data</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">AWS_ACCESS_KEY_ID</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">c0M0R2xVanF3ODR3bHBkVW94cmY=</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">AWS_SECRET_ACCESS_KEY</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Wi9kcFluSWxHRzlWaFlzNk1hc0xma2JXcjM1MVhqa051SlBleXpmOQ==</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Secret</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">creationTimestamp</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;2019-10-24T13:30:07Z&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">finalizers</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">objectbucket.io/finalizer</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">noobaa</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">bucket-provisioner</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage.noobaa.io-obc</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">noobaa-domain</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage.noobaa.io</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">test21obc</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ownerReferences</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">objectbucket.io/v1alpha1</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">blockOwnerDeletion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">true</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">controller</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">true</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ObjectBucketClaim</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">test21obc</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">uid</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">64f04cba-f662-11e9-bc3c-0295250841af</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">resourceVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;40751&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selfLink</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/api/v1/namespaces/openshift-storage/secrets/test21obc</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">uid</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">65117c1c-f662-11e9-9094-0a5305de57bb</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">type</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">Opaque</span></code></pre>
</div>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get -n openshift-storage cm test21obc -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">v1</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">data</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">BUCKET_HOST</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">10.0.171.35</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">BUCKET_NAME</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">test21obc-933348a6-e267-4f82-82f1-e59bf4fe3bb4</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">BUCKET_PORT</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;31242&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">BUCKET_REGION</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">BUCKET_SUBREGION</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;&quot;</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ConfigMap</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">metadata</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">creationTimestamp</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;2019-10-24T13:30:07Z&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">finalizers</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">objectbucket.io/finalizer</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">labels</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">app</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">noobaa</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">bucket-provisioner</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage.noobaa.io-obc</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">noobaa-domain</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage.noobaa.io</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">test21obc</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">namespace</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">openshift-storage</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ownerReferences</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-p tok-p-Indicator">-</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">apiVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">objectbucket.io/v1alpha1</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">blockOwnerDeletion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">true</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">controller</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">true</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kind</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ObjectBucketClaim</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">name</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">test21obc</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">uid</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">64f04cba-f662-11e9-bc3c-0295250841af</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">resourceVersion</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;40752&quot;</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">selfLink</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/api/v1/namespaces/openshift-storage/configmaps/test21obc</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">uid</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">651c6501-f662-11e9-9094-0a5305de57bb</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the secret gives us the S3 access credentials, while the CM contains the S3 endpoint information for our application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_an_obc_inside_a_container">5.3. Using an OBC inside a container</h3>
<div class="paragraph">
<p>In this section we will see how one can create an OBC using a YAML file and use the provided S3 configuration in an example application.</p>
</div>
<div class="paragraph">
<p>To deploy the OBC example, you can use the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>apiVersion: v1
kind: Namespace
metadata:
  name: obc-test
---
apiVersion: objectbucket.io/v1alpha1
kind: ObjectBucketClaim
metadata:
  name: obc-test
  namespace: obc-test
spec:
  generateBucketName: "obc-test-noobaa"
  storageClassName: openshift-storage.noobaa.io
---
apiVersion: batch/v1
kind: Job
metadata:
  name: obc-test
  namespace: obc-test
  labels:
    app: obc-test
spec:
  template:
    metadata:
      labels:
        app: obc-test
    spec:
      restartPolicy: OnFailure
      containers:
        - image: mesosphere/aws-cli:latest
          command: ["sh"]
          args:
            - '-c'
            - 'set -x &amp;&amp; s3cmd --no-check-certificate --host $BUCKET_HOST:$BUCKET_PORT --host-bucket $BUCKET_HOST:$BUCKET_PORT du'
          name: obc-test
          env:
            - name: BUCKET_NAME
              valueFrom:
                configMapKeyRef:
                  name: obc-test
                  key: BUCKET_NAME
            - name: BUCKET_HOST
              valueFrom:
                configMapKeyRef:
                  name: obc-test
                  key: BUCKET_HOST
            - name: BUCKET_PORT
              valueFrom:
                configMapKeyRef:
                  name: obc-test
                  key: BUCKET_PORT
            - name: AWS_DEFAULT_REGION
              valueFrom:
                configMapKeyRef:
                  name: obc-test
                  key: BUCKET_REGION
            - name: AWS_ACCESS_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: obc-test
                  key: AWS_ACCESS_KEY_ID
            - name: AWS_SECRET_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: obc-test
                  key: AWS_SECRET_ACCESS_KEY</pre>
</div>
</div>
<div class="paragraph">
<p>The first part creates an OBC that will create a ConfigMap and a secret that have the same name as the OBC (obc-test).
The second part of the file (after the ---), creates a Job that deploys a container with the s3cmd pre-installed.
It will execute s3cmd with the appropriate command line arguments and exit. S3cmd will in this case report the current disk usage
of our S3 endpoint and exit, which will mark our <strong>Pod</strong> as <code>Completed</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s try this out.</p>
</div>
<div class="listingblock execute">
<div class="title">Deploy the manifest</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl -s https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4ocs4/obc_app_example.yaml <span class="tok-p">|</span> oc apply -f -</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>namespace/obc-test created
objectbucketclaim.objectbucket.io/obc-test created
job.batch/obc-test created</pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards watch the <strong>Pod</strong> be Created, Run and finally be marked Completed like below - be aware that your <strong>Pod</strong> name will differ:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get pods -n obc-test -l <span class="tok-nv">app</span><span class="tok-o">=</span>obc-test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME             READY   STATUS              RESTARTS   AGE
obc-test-lbjs6   0/1     Completed   0          12s</pre>
</div>
</div>
<div class="paragraph">
<p>Then you can check the <code>obc-test</code> <strong>Pod</strong> logs for the contents of the S3 bucket using the command below (in this case there are zero objects in the bucket).</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>kubectl logs -n obc-test -l <span class="tok-nv">app</span><span class="tok-o">=</span>obc-test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>+ s3cmd --no-check-certificate --host 10.0.165.175:30409 --host-bucket 10.0.165.175:30409 du
0        0 objects s3://obc-test-noobaa-ca7b4daa-1828-43c2-8644-34ef2fc78026/
--------
0        Total</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_storage_to_the_ceph_cluster">6. Adding storage to the Ceph Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Adding storage to OCS adds capacity and performance to your already present cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For this you can select to either add more storage worker nodes, or leverage the already present nodes to add more storage capacity.
The reason for adding more OCP worker nodes for storage is because the existing nodes do not have adequate CPU and/or Memory available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_add_storage_worker_nodes">6.1. Add storage worker nodes</h3>
<div class="paragraph">
<p>This section will explain how one can add more worker nodes to the present storage cluster. Afterwards follow the next sub-section on how to extend the OCS cluster to provision storage on these new nodes.</p>
</div>
<div class="paragraph">
<p>To add more nodes, we could either add more machinesets like we did before, or scale the already present OCS machinesets. For this training, we will spawn more workers by scaling the already present OCS worker instances up:</p>
</div>
<div class="listingblock execute">
<div class="title">Check on our present machinesets</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get machinesets -n openshift-machine-api <span class="tok-p">|</span> grep workerocs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cluster-acf9-k8nzk-workerocs-us-east-2a   1         1         1       1           6h50m
cluster-acf9-k8nzk-workerocs-us-east-2b   1         1         1       1           6h50m
cluster-acf9-k8nzk-workerocs-us-east-2c   1         1         1       1           6h50m</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s scale the <strong>workerocs</strong> <code>machinesets</code> up with this command:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get machinesets -n openshift-machine-api -o name <span class="tok-p">|</span> grep workerocs <span class="tok-p">|</span> xargs -n1 -t oc scale -n openshift-machine-api --replicas<span class="tok-o">=</span><span class="tok-m">2</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>oc scale -n openshift-machine-api --replicas=2 machineset.machine.openshift.io/cluster-acf9-k8nzk-workerocs-us-east-2a
machineset.machine.openshift.io/cluster-acf9-k8nzk-workerocs-us-east-2a scaled
oc scale -n openshift-machine-api --replicas=2 machineset.machine.openshift.io/cluster-acf9-k8nzk-workerocs-us-east-2b
machineset.machine.openshift.io/cluster-acf9-k8nzk-workerocs-us-east-2b scaled
oc scale -n openshift-machine-api --replicas=2 machineset.machine.openshift.io/cluster-acf9-k8nzk-workerocs-us-east-2c
machineset.machine.openshift.io/cluster-acf9-k8nzk-workerocs-us-east-2c scaled</pre>
</div>
</div>
<div class="paragraph">
<p>Wait until the new workers are available.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>watch oc get machinesets -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once they are available, we can check on their labels like this:</p>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>NAME                                      DESIRED   CURRENT   READY   AVAILABLE   AGE
cluster-acf9-k8nzk-worker-us-east-2a      1         1         1       1           23h
cluster-acf9-k8nzk-worker-us-east-2b      1         1         1       1           23h
cluster-acf9-k8nzk-worker-us-east-2c      0         0                             23h
cluster-acf9-k8nzk-workerocs-us-east-2a   2         2         2       2           23h
cluster-acf9-k8nzk-workerocs-us-east-2b   2         2         2       2           23h
cluster-acf9-k8nzk-workerocs-us-east-2c   2         2         2       2           23h</pre>
</div>
</div>
<div class="paragraph">
<p>Apply the <code>cluster.ocs.openshift.io/openshift-storage</code> label to the new nodes:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get nodes -o json <span class="tok-p">|</span> jq <span class="tok-s1">&#39;.items[] | select(.metadata.labels.role == &quot;storage-node&quot;) | .metadata.name&#39;</span> <span class="tok-p">|</span> xargs -n1 -t -I <span class="tok-o">{}</span> oc label nodes <span class="tok-o">{}</span> cluster.ocs.openshift.io/openshift-storage<span class="tok-o">=</span><span class="tok-s2">&quot;&quot;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>oc label nodes ip-10-0-135-180.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage=
node/ip-10-0-135-180.us-east-2.compute.internal labeled
oc label nodes ip-10-0-143-146.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage=
error: 'cluster.ocs.openshift.io/openshift-storage' already has a value (), and --overwrite is false
oc label nodes ip-10-0-152-141.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage=
node/ip-10-0-152-141.us-east-2.compute.internal labeled
oc label nodes ip-10-0-153-135.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage=
error: 'cluster.ocs.openshift.io/openshift-storage' already has a value (), and --overwrite is false
oc label nodes ip-10-0-165-175.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage=
error: 'cluster.ocs.openshift.io/openshift-storage' already has a value (), and --overwrite is false
oc label nodes ip-10-0-169-181.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage=
node/ip-10-0-169-181.us-east-2.compute.internal labeled</pre>
</div>
</div>
<div class="paragraph">
<p>We get errors for the nodes which already had the label applied, which is fine.
Now we have the new instances prepared for extending the cluster, proceed to the next chapter to provision storage on these empty instances, the OCS operator will pick prefer the empty instances for new storage.</p>
</div>
</div>
<div class="sect2">
<h3 id="_add_storage_capacity">6.2. Add storage capacity</h3>
<div class="paragraph">
<p>In this section we will add storage capacity and performance to the configured OCS worker nodes. If you have followed the previous section you should now have 6 OCS nodes, otherwise you have three worker nodes, which is fine too.</p>
</div>
<div class="paragraph">
<p>To add storage, go to the Openshift Web Console and follow the steps to reach the OCS storage cluster overview:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <code>Operators</code> on the left navigation bar</p>
</li>
<li>
<p>Select <code>Installed Operators</code></p>
</li>
<li>
<p>Click on <code>Openshift Container Storage Operator</code></p>
</li>
<li>
<p>In the top navigation bar, scroll right to find the item <code>Storage Cluster</code> and click on it</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-Storage-Cluster-overview-reachit.png" alt="OCS Storage Cluster overview reachit">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The visible list should list only one item - click on the three dots on the far right to extend the options menu</p>
</li>
<li>
<p>Select <code>Add Capacity</code> from the options menu</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCS-add-capacity.png" alt="OCS add capacity">
</div>
<div class="title">Figure 13. Add capacity dialog</div>
</div>
<div class="paragraph">
<p>In the new dialog you can set the requested additional (usable) capacity and the storage class. On AWS, the storage class should be set to <code>gp2</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The effectivly provisioned capacity will be three times as much as you put into the <code>Requested Capacity</code> field, because OCS uses a replica count of 3.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you are done with your setting, proceed by clicking on <code>Add</code>. You will see the Status of the Storage Cluster change until it reaches <code>Ready</code> again.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Due to a bug in the current version, a new storage capacity won&#8217;t be added. will be fixed soon
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now see that there are new OSD pods and if you previously added new ndoes that they use the new OCS worker nodes:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get pod -n openshift-storage <span class="tok-p">|</span> grep osd</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>rook-ceph-osd-0-857b9cd4b-46zdb                                   1/1     Running     0          22h
rook-ceph-osd-1-fb45c66dc-pqqmx                                   1/1     Running     0          22h
rook-ceph-osd-2-6b96c984c4-4dgs2                                  1/1     Running     0          22h
rook-ceph-osd-prepare-ocs-deviceset-0-0-x8hf8-vvjwq               0/1     Completed   0          22h
rook-ceph-osd-prepare-ocs-deviceset-0-1-l4skg-n2g54               0/1     Init:0/2    0          22s
rook-ceph-osd-prepare-ocs-deviceset-1-0-ctf89-tmmmx               0/1     Completed   0          22h
rook-ceph-osd-prepare-ocs-deviceset-1-1-9t8l9-2lbbp               0/1     Init:0/2    0          20s
rook-ceph-osd-prepare-ocs-deviceset-2-0-7fktc-zvspp               0/1     Completed   0          22h
rook-ceph-osd-prepare-ocs-deviceset-2-1-p64cm-qr9vm               0/1     Init:0/2    0          18s</pre>
</div>
</div>
<div class="paragraph">
<p>Wait for all the new OSDs to come up.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc get pod -n openshift-storage <span class="tok-p">|</span> grep osd</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>rook-ceph-osd-0-857b9cd4b-46zdb                                   1/1     Running     0          22h
rook-ceph-osd-1-fb45c66dc-pqqmx                                   1/1     Running     0          22h
rook-ceph-osd-2-6b96c984c4-4dgs2                                  1/1     Running     0          22h
rook-ceph-osd-3-799bdcd665-8xplr                                  1/1     Running     0          56s
rook-ceph-osd-4-7d7888888d-8vbqn                                  1/1     Running     0          53s
rook-ceph-osd-5-6c96c457fd-gzl9n                                  1/1     Running     0          47s
rook-ceph-osd-prepare-ocs-deviceset-0-0-x8hf8-vvjwq               0/1     Completed   0          22h
rook-ceph-osd-prepare-ocs-deviceset-0-1-l4skg-n2g54               0/1     Completed   0          93s
rook-ceph-osd-prepare-ocs-deviceset-1-0-ctf89-tmmmx               0/1     Completed   0          22h
rook-ceph-osd-prepare-ocs-deviceset-1-1-9t8l9-2lbbp               0/1     Completed   0          91s
rook-ceph-osd-prepare-ocs-deviceset-2-0-7fktc-zvspp               0/1     Completed   0          22h
rook-ceph-osd-prepare-ocs-deviceset-2-1-p64cm-qr9vm               0/1     Completed   0          89s</pre>
</div>
</div>
<div class="paragraph">
<p>This is everything that you need to do to extend the OCS storage.</p>
</div>
</div>
<div class="sect2">
<h3 id="_verify_new_storage">6.3. Verify new storage</h3>
<div class="paragraph">
<p>Once you added the capacity and made sure that the OSD pods are present, you can also optionally check the additional storage capacity using the Ceph tools. To do this, follow these steps:</p>
</div>
<div class="listingblock execute">
<div class="title">Enter the tools pod that you created in <a href="#_using_the_rook_ceph_toolbox_to_check_on_the_ceph_backing_storage">the previous section</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">TOOLS_POD</span><span class="tok-o">=</span><span class="tok-k">$(</span>oc get pods -n openshift-storage -l <span class="tok-nv">app</span><span class="tok-o">=</span>rook-ceph-tools -o name<span class="tok-k">)</span>
oc rsh -n openshift-storage <span class="tok-nv">$TOOLS_POD</span></code></pre>
</div>
</div>
<div class="listingblock execute">
<div class="title">Check the status of the Ceph cluster</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>ceph status</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>cluster:
  id:     7d0f7306-84fa-4e32-a04d-f7a588501487
  health: HEALTH_OK

services:
  mon: 3 daemons, quorum a,b,c (age 21h)
  mgr: a(active, since 22h)
  mds: ocs-storagecluster-cephfilesystem:1 {0=ocs-storagecluster-cephfilesystem-a=up:active} 1 up:standby-replay
  osd: 6 osds: 6 up (since 82s), 6 in (since 82s) <i class="conum" data-value="1"></i><b>(1)</b>

data:
  pools:   3 pools, 24 pgs
  objects: 205 objects, 456 MiB
  usage:   7.1 GiB used, 12 TiB / 12 TiB avail <i class="conum" data-value="2"></i><b>(2)</b>
  pgs:     24 active+clean

io:
  client:   1.2 KiB/s rd, 11 KiB/s wr, 2 op/s rd, 0 op/s wr</pre>
</div>
</div>
<div class="paragraph">
<p>In the Ceph status output, we can already see that:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We now use 6 osds in total and they are <code>up</code> and <code>in</code> (meaning the deamons are running and being used to store data)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The available raw capacity has increased from 3 TiB to 6 TiB</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Besides that, nothing has changed in the output.</p>
</div>
<div class="listingblock execute">
<div class="title">Check the topology of your cluster</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>ceph osd crush tree</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>ID  CLASS WEIGHT   TYPE NAME
 -1       11.99396 root default
 -5       11.99396     region us-east-2
-10        3.99799         zone us-east-2a
 -9        1.99899             host ocs-deviceset-2-0-7fktc
  1   ssd  1.99899                 osd.1
-21        1.99899             host ocs-deviceset-2-1-p64cm <i class="conum" data-value="1"></i><b>(1)</b>
  5   ssd  1.99899                 osd.5
-14        3.99799         zone us-east-2b
-13        1.99899             host ocs-deviceset-0-0-x8hf8
  2   ssd  1.99899                 osd.2
-19        1.99899             host ocs-deviceset-0-1-l4skg <i class="conum" data-value="1"></i><b>(1)</b>
  4   ssd  1.99899                 osd.4
 -4        3.99799         zone us-east-2c
 -3        1.99899             host ocs-deviceset-1-0-ctf89
  0   ssd  1.99899                 osd.0
-17        1.99899             host ocs-deviceset-1-1-9t8l9 <i class="conum" data-value="1"></i><b>(1)</b>
  3   ssd  1.99899                 osd.3</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We now have additional hosts, which are extending the hosts in the respective zone</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since our Ceph cluster&#8217;s CRUSH rules are set up to replicate data between the zones, this is an effective way to relax the load on the previous nodes.</p>
</div>
<div class="paragraph">
<p>If you did not add more nodes and skipped the <a href="#_add_storage_worker_nodes">Add storage worker nodes</a> section, then your output will be similar to this:</p>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>ID  CLASS WEIGHT  TYPE NAME
 -1       5.99396 root default
 -5       5.99396     region us-east-2
 -4       1.99799         zone us-east-2a
 -3       0.99899             host ocs-deviceset-2-0-7fktc
  0   ssd 0.99899                 osd.0
  5   ssd 0.99899                 osd.5 <i class="conum" data-value="1"></i><b>(1)</b>
-10       1.99799         zone us-east-2b
 -9       0.99899             host ocs-deviceset-1-0-x8hf8
  1   ssd 0.99899                 osd.1
  4   ssd 0.99899                 osd.4 <i class="conum" data-value="1"></i><b>(1)</b>
-14       1.99799         zone us-east-2c
-13       0.99899             host ocs-deviceset-0-0-ctf89
  2   ssd 0.99899                 osd.2
  3   ssd 0.99899                 osd.3 <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>These are the new OSDs that we added to the existing hosts</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is an effective way to scale out capacity and performance if you observe that your hosts are not exhausted, but you are running out of either capacity or IOPs.</p>
</div>
<div class="paragraph">
<p>In both scale-out cases, existing data on the old OSDs will be balanced out automatically, so that the old and the new OSDs share the load.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_must_gather">7. Using must-gather</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Must-gather is a tool for collecting data about the current&#8217;y running Openshift cluster. It loads a predefined set of containers that execute multiple programs and dump it on the local workstations filesystem.
The local files can then be used by a remote support engineer to debug a problem more easily without needing direct cluster access. This is similar to sosreports for RHEL hosts.</p>
</div>
<div class="paragraph">
<p>The OCS team has released its own image for the must-gather tool that runs storage specific commands.</p>
</div>
<div class="paragraph">
<p>You can run this diagnostic tool like this for generic Openshift debugging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc adm must-gather</pre>
</div>
</div>
<div class="paragraph">
<p>Or like this for OCS specific insights:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc adm must-gather --image=quay.io/ocs-dev/ocs-must-gather</pre>
</div>
</div>
<div class="paragraph">
<p>The output will then be saved in the current directory inside of a new folder called <code>must-gather.local.(random)</code></p>
</div>
<div class="paragraph">
<p>More runtime options can be displayed with</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc adm must-gather -h</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>Launch a pod to gather debugging information

 This command will launch a pod in a temporary namespace on your cluster that gathers debugging information and then
downloads the gathered information.

 Experimental: This command is under active development and may change without notice.

Usage:
  oc adm must-gather [flags]

Examples:
  # gather information using the default plug-in image and command, writing into ./must-gather.local.&lt;rand&gt;
  oc adm must-gather

  # gather information with a specific local folder to copy to
  oc adm must-gather --dest-dir=/local/directory

  # gather information using multiple plug-in images
  oc adm must-gather --image=quay.io/kubevirt/must-gather --image=quay.io/openshift/origin-must-gather

  # gather information using a specific image stream plug-in
  oc adm must-gather --image-stream=openshift/must-gather:latest

  # gather information using a specific image, command, and pod-dir
  oc adm must-gather --image=my/image:tag --source-dir=/pod/directory -- myspecial-command.sh

Options:
      --dest-dir='': Set a specific directory on the local machine to write gathered data to.
      --image=[]: Specify a must-gather plugin image to run. If not specified, OpenShift's default must-gather image
will be used.
      --image-stream=[]: Specify an image stream (namespace/name:tag) containing a must-gather plugin image to run.
      --node-name='': Set a specific node to use - by default a random master will be used
      --source-dir='/must-gather/': Set the specific directory on the pod copy the gathered data from.

Use "oc adm options" for a list of global command-line options (applies to all commands).</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_local_oc_client">Appendix A: Configuring the local oc client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section will explain how you set up your workstation with the Openshift CLI.</p>
</div>
<div class="paragraph">
<p>To get the latest OpenShift CLI client run the following commands:</p>
</div>
<div class="listingblock">
<div class="title">Mac steps</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/ --no-directories --accept<span class="tok-o">=</span><span class="tok-s2">&quot;*client-mac*&quot;</span> --quiet --recursive --level<span class="tok-o">=</span><span class="tok-m">1</span>
ls -1 openshift-client-mac-*.tar.gz <span class="tok-p">|</span> tail -n1 <span class="tok-p">|</span> xargs -I <span class="tok-o">{}</span> tar xzvf <span class="tok-o">{}</span> oc
sudo mv oc /usr/local/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition install the watch command to use with the <code>oc client</code> on your Mac using Homebrew.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>brew install watch</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, add the following lines to your $HOME/.profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>function watch {
while :; do clear; date; echo; $@; sleep 2; done
}</pre>
</div>
</div>
<div class="paragraph">
<p>Then reload your profile with <code>source $HOME/.profile</code>.</p>
</div>
<div class="listingblock">
<div class="title">Linux steps</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/ --no-directories --accept<span class="tok-o">=</span><span class="tok-s2">&quot;*client-linux*&quot;</span> --quiet --recursive --level<span class="tok-o">=</span><span class="tok-m">1</span>
ls -1 openshift-client-linux-*.tar.gz <span class="tok-p">|</span> tail -n1 <span class="tok-p">|</span> xargs -I <span class="tok-o">{}</span> tar xzvf <span class="tok-o">{}</span> oc
sudo mv oc /usr/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards, go to your Openshift Web Console, log in and click on the username in the top right corner. There you will find the menu item <code>Copy Login Command</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/OCP-copy-login-command.png" alt="OCP copy login command">
</div>
<div class="title">Figure 14. Copy Login command menu entry</div>
</div>
<div class="paragraph">
<p>Clicking on <code>Copy Login Command</code> will open a new window and you might be required to login to your Openshift cluster again.
After successfully login in, you see blue text <code>Display token</code> - click this and you will be shown your login command.</p>
</div>
<div class="paragraph">
<p>The login command will look similar to this</p>
</div>
<div class="paragraph">
<p><code>oc login --token=zoNoANLOOoJzXV3sb-TE1xIcg2aLBssdN0bTNIuV29w --server=https://api.cluster-ocs-89db.ocs-89db.example.opentlc.com:6443</code></p>
</div>
<div class="paragraph">
<p>execute this login command on your terminal. If you did not provision your RHPDS environment with Let&#8217;s Encrypt certificates, it will ask if you want to connect without certificate checks, accept this.</p>
</div>
<div class="paragraph">
<p>Check if you are successfully connected by issuing a command against the cluster:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>oc version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>Client Version: openshift-clients-4.2.0-201910041700
Server Version: 4.2.0
Kubernetes Version: v1.14.6+2e5ed54</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above commands will always pull the latest oc version, so your version might be higher than the version in the example output.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_the_noobaa_cli_client">Appendix B: Install the NooBaa CLI client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install the CLI, follow these steps on your workstation:</p>
</div>
<div class="listingblock">
<div class="title">Mac steps</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>brew install noobaa/noobaa/noobaa</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Mac steps without Homebrew</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl -s https://api.github.com/repos/noobaa/noobaa-operator/releases/latest <span class="tok-p">|</span> grep <span class="tok-s2">&quot;mac&quot;</span> <span class="tok-p">|</span> cut -d : -f <span class="tok-m">2</span>,3 <span class="tok-p">|</span> tr -d <span class="tok-se">\&quot;</span> <span class="tok-p">|</span> wget -qi - <span class="tok-p">;</span> mv noobaa-mac-* noobaa <span class="tok-p">;</span> chmod +x noobaa<span class="tok-p">;</span> sudo mv noobaa /usr/local/bin/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Linux steps</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>curl -s https://api.github.com/repos/noobaa/noobaa-operator/releases/latest <span class="tok-p">|</span> grep <span class="tok-s2">&quot;linux&quot;</span> <span class="tok-p">|</span> cut -d : -f <span class="tok-m">2</span>,3 <span class="tok-p">|</span> tr -d <span class="tok-se">\&quot;</span> <span class="tok-p">|</span> wget -qi - <span class="tok-p">;</span> mv noobaa-linux-* noobaa <span class="tok-p">;</span> chmod +x noobaa<span class="tok-p">;</span> sudo mv noobaa /usr/bin/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check that your noobaa CLI installation was successful with this command:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>noobaa version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre>noobaa version
INFO[0000] CLI version: 2.0.4
INFO[0000] noobaa-image: noobaa/noobaa-core:5
INFO[0000] operator-image: noobaa/noobaa-operator:2.0.4</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above commands will always pull the latest noobaa version, so your version might be higher than the version in the example output.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_ceph">Appendix C: Introduction to Ceph</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section will go through Ceph fundamental knowledge for a better understanding of the underlying storage solution
used by OCS 4.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The content in this Appendix is relevant to learning about the critical components of Ceph and how Ceph works. OCS 4 uses Ceph in a prescribed manner for providing storage to OpenShift applications. Using <strong>Operators</strong> and <strong>CustomResourceDefinitions</strong> (CRDs) for deploying and managing OCS 4 may restrict some of Ceph&#8217;s advanced features when compared to general use outside of OCP 4.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph lead">
<p><strong>Timeline</strong></p>
</div>
<div class="paragraph">
<p>The Ceph project has a long history as you can see in the timeline below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-timeline.png" alt="Ceph Project Timeline">
</div>
<div class="title">Figure 15. Ceph Project History</div>
</div>
<div class="paragraph lead">
<p>It is a battle-tested software defined storage (SDS) solution that has been available as a storage backend for OpenStack and Kubernetes for quite some time.</p>
</div>
<div class="paragraph lead">
<p><strong>Architecture</strong></p>
</div>
<div class="paragraph">
<p>The Ceph cluster provides a scalable storage solution while providing multiple access methods to enable the different types of
clients present within the IT infrastructure to get access to the data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-overview.png" alt="Ceph From Above">
</div>
<div class="title">Figure 16. Ceph Architecture</div>
</div>
<div class="paragraph lead">
<p>The entire Ceph architecture is resilient and does not present any single point of failure (SPOF).</p>
</div>
<div class="paragraph lead">
<p><strong>RADOS</strong></p>
</div>
<div class="paragraph">
<p>The heart of Ceph is an object store known as RADOS (Reliable Autonomic Distributed Object Store) bottom layer on the screen. This
layer provides the Ceph software defined storage with the ability to store data (serve IO requests, to protect the data, to check
the consistency and the integrity of the data through built-in mechanisms. The RADOS layer is composed of the following daemons:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>MONs or Monitors</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>OSDs or Object Storage Devices</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>MGRs or Managers</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>MDSs or Meta Data Servers</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title"><strong><em>Monitors</em></strong></div>
<p>The Monitors maintain the cluster map and state and provide distributed decision-making while configured in an odd number, 3 or 5 depending
on the size and the topology of the cluster, to prevent split-brain situations. The Monitors are not in the data-path and do not serve IO
requests to and from the clients.</p>
</div>
<div class="paragraph">
<div class="title"><strong><em>OSDs</em></strong></div>
<p>One OSD is typically deployed for each local block devices and the native scalable nature of Ceph allows for thousands of OSDs to be part of the cluster.
The OSDs are serving IO requests from the clients while guaranteeing the protection of the data (replication or erasure coding), the rebalancing of the data
in case of an OSD or a node failure, the coherence of the data (scrubbing and deep-scrubbing of the existing data).</p>
</div>
<div class="paragraph">
<div class="title"><strong><em>MGRs</em></strong></div>
<p>The Managers are tightly integrated with the Monitors and collect the statistics within the cluster. Additionally they provide an extensible framework for the
cluster through a pluggable Python interface aimed at expanding the Ceph existing capabilities. The current list of modules developed around the Manager framework
are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Balancer module</p>
</li>
<li>
<p>Placement Group auto-scaler module</p>
</li>
<li>
<p>Dashboard module</p>
</li>
<li>
<p>RESTful module</p>
</li>
<li>
<p>Prometheus module</p>
</li>
<li>
<p>Zabbix module</p>
</li>
<li>
<p>Rook module</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title"><strong><em>MDSs</em></strong></div>
<p>The Meta Data Servers manage the metadata for the POSIX compliant shared filesystem such as the directory hierarchy and the file metadata (ownership, timestamps, mode, &#8230;&#8203;).
All the metadata is stored with RADOS and they do not server any data to the clients. MDSs are only deployed when a shared filesystem is configured in the Ceph cluster.</p>
</div>
<div class="paragraph">
<p>If we look at the Ceph cluster foundation layer, the full picture with the different types of daemons or containers looks like this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-rados.png" alt="RADOS Overview">
</div>
<div class="title">Figure 17. RADOS as it stands</div>
</div>
<div class="paragraph">
<p>The circle represent the MONs, the 'M' represent the MGRs and the squares with the bars represent the OSDs. In the diagram above, the cluster operates with
3 Monitors, 2 Managers and 23 OSDs.</p>
</div>
<div class="paragraph lead">
<p><strong>Access Methods</strong></p>
</div>
<div class="paragraph">
<p>Ceph was designed to provides the IT environment with all the necessary access methods so that any application can use what is the best solution for its use-case.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-differentstoragetypes.png" alt="Ceph Access Modes">
</div>
<div class="title">Figure 18. Different Storage Types Supported</div>
</div>
<div class="paragraph">
<p>Ceph supports block storage through the RADOS Block Device (aka RBD) access method, file storage through the Ceph Filesystem (aka CephFS) access method and
object storage through its native <code>librados</code> API or through the RADOS Gateway (aka RADOSGW or RGW) for compatibility with the S3 and Swift protocols.</p>
</div>
<div class="paragraph lead">
<p><strong>Librados</strong></p>
</div>
<div class="paragraph">
<p>Librados allows developers to code natively against the native Ceph cluster API for maximum efficiency combined with a small footprint.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-librados.png" alt="librados">
</div>
<div class="title">Figure 19. Application Native Object API</div>
</div>
<div class="paragraph">
<p>The Ceph native API offers different wrappers such as C, C++, Python, Java, Ruby, Erlang, Go and Rust.</p>
</div>
<div class="paragraph lead">
<p><strong>RADOS Block Device (RBD)</strong></p>
</div>
<div class="paragraph">
<p>This access method is used in Red Hat Enterprise Linux or OpenShift version 3.x or 4.x. RBDs can be accessed either through a kernel module (RHEL, OCS4)
or through the <code>librbd</code> API (RHOSP). In the OCP world, RBDs are designed to address the need for RWO PVCs.</p>
</div>
<div class="paragraph lead">
<p><strong><em>Kernel Module (kRBD)</em></strong></p>
</div>
<div class="paragraph">
<p>The kernel RBD driver offers superior performance compared to the userspace <code>librbd</code> method. However, kRBD is currently limited and does
not provide the same level of functionality. e.g., no RBD Mirroring support.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-krbd.png" alt="Kernel based RADOS Block Device">
</div>
<div class="title">Figure 20. kRBD Diagram</div>
</div>
<div class="paragraph lead">
<p><strong><em>Userspace RBD (librbd)</em></strong></p>
</div>
<div class="paragraph">
<p>This access method is used in Red Hat OpenStack Environment or OpenShift through the RBD-NBD driver when available starting in the RHEL 8.1 kernel.
This mode allows us to leverage all existing RBD features such as RBD Mirroring.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-librbd.png" alt="Userspace RADOS Block Device">
</div>
<div class="title">Figure 21. librbd Diagram</div>
</div>
<div class="paragraph lead">
<p><strong><em>Shared Filesystem (CephFS)</em></strong></p>
</div>
<div class="paragraph">
<p>This method allows clients to jointly access a shared POSIX compliant filesystem. The client initially contacts the Meta Data Server to obtain
the location of the object(s) for a given inode and then communicates directly with an OSD to perform the final IO request.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-cephfs.png" alt="Kernel Based CephFS Client">
</div>
<div class="title">Figure 22. File Access (Ceph Filesystem or CephFS)</div>
</div>
<div class="paragraph">
<p>CephFS is typically used for RWX claims but can also be used to support RWO claims.</p>
</div>
<div class="paragraph lead">
<p><strong><em>Object Storage, S3 and Swift (Ceph RADOS Gateway)</em></strong></p>
</div>
<div class="paragraph">
<p>This access method offers support for the Amazon S3 and OpenStack Swift support on top of a Ceph cluster. The Openshift Container Storage Multi Cloud
Gateway can leverage the RADOS Gateway to support Object Bucket Claims. From the Multi Cloud Gateway perspective the RADOS Gateway will be tagged
as a compatible S3 endpoint.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-rgw.png" alt="S3 and Swift Support">
</div>
<div class="title">Figure 23. Amazone S3 or OpenStack Swift (Ceph RADOS Gateway)</div>
</div>
<div class="paragraph lead">
<p><strong>CRUSH</strong></p>
</div>
<div class="paragraph">
<p>The Ceph cluster being a distributed architecture some solution had to be designed to provide an efficient way to distribute the data across the multiple
OSDs in the cluster. The technique used is called CRUSH or Controlled Replication Under Scalable Hashing. With CRUSH, every object is assigned to one
and only one hash bucket known as a Placement Group (PG).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-crushfromobjecttoosd.png" alt="From Object to OSD">
</div>
</div>
<div class="paragraph">
<p>CRUSH is the central point of configuration for the topology of the cluster. It offers a pseudo-random placement algorithm to distribute the objects across
the PGs and uses rules to determine the mapping of the PGs to the OSDs. In essence, the PGs are an abstraction layer between the objects (application layer)
and the OSDs (physical layer). In case of failure, the PGs will be remapped to different physical devices (OSDs) and eventually see their content resynchronized
to match the protection rules  selected by the storage administrator.</p>
</div>
<div class="paragraph lead">
<p><strong>Cluster Partitioning</strong></p>
</div>
<div class="paragraph">
<p>The Ceph OSDs will be in charge of the protection of the data as well as the constant checking of the integrity of the data stored in the entire cluster.
The cluster will be separated into logical partitions, known as pools. Each pool has the following properties that can be adjusted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An ID (immutable)</p>
</li>
<li>
<p>A name</p>
</li>
<li>
<p>A number of PGs to distribute the objects across the OSDs</p>
</li>
<li>
<p>A CRUSH rule to determine the mapping of the PGs for this pool</p>
</li>
<li>
<p>A type of protection (Replication or Erasure Coding)</p>
</li>
<li>
<p>Parameters associated with the type of protection</p>
<div class="ulist">
<ul>
<li>
<p>Number of copies for replicated pools</p>
</li>
<li>
<p>K and M chunks for Erasure Coding</p>
</li>
</ul>
</div>
</li>
<li>
<p>Various flags to influence the behavior of the cluster</p>
</li>
</ul>
</div>
<div class="paragraph lead">
<p><strong>Pools and PGs</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-thefullpicture.png" alt="From Object to OSD">
</div>
<div class="title">Figure 24. Pools and PGs</div>
</div>
<div class="paragraph">
<p>The diagram above shows the relationship end to end between the object at the access method level down to the OSDs at the physical layer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A Ceph pool has no size and is able to consume the space available any OSD where its PGs are created. A Placement Group or PG belongs to only one pool.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph lead">
<p><strong>Data Protection</strong></p>
</div>
<div class="paragraph">
<p>Ceph supports two types of data protection presented in the diagram below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-dataprotection.png" alt="Replicated Pools vs Erasure Coded Pools">
</div>
<div class="title">Figure 25. Ceph Data Protection</div>
</div>
<div class="paragraph">
<p>Replicated pools provide better performance in almost all cases at the cost of a lower usable to raw storage ratio (1 usable byte is stored using 3 bytes of raw storage)
while <code>Erasure Coding</code> provides a cost efficient way to store data with less performance. Red Hat supports the following <code>Erasure Coding</code> profiles with their corresponding usable to raw ratio:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>4+2 (1:2 ratio)</p>
</li>
<li>
<p>8+3 (1:1.375 ratio)</p>
</li>
<li>
<p>8+4 (1:2 ratio)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another advantage of <code>Erasure Coding</code> (EC) is its ability to offer extreme resilience and durability as we can configure the number of parities being used.
EC can be used for the RADOS Gateway access method and for the RBD access method (performance impact).</p>
</div>
<div class="paragraph lead">
<p><strong>Data Distribution</strong></p>
</div>
<div class="paragraph">
<p>To leverage the Ceph architecture at its best, all access methods but librados, will access the data in the cluster through a collection of objects. Hence a 1GB
block device will be a collection of objects, each supporting a set of device sectors. Therefore, a 1GB file is stored in a CephFS directory will be split into multiple objects. Also a 5GB S3 object stored through the RADOS Gateway via the Multi Cloud Gateway will be divided in multiple objects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="imgs/ceph101-rbdlayout.png" alt="RADOS Block Device Layout">
</div>
<div class="title">Figure 26. Data Distribution</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, each access method uses an object size of 4MB. The above diagram details how a 32MB RBD (Block Device) supporting a RWO PVC will be scattered throughout the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-04-04 13:15:40 PDT
</div>
</div>
</body>
</html>